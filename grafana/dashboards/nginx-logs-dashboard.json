{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "id": 5,
  "links": [],
  "panels": [
    {
      "datasource": "loki",
      "description": "–ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ 4xx –∏ 5xx –æ—Ç –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.\n–í—ã—Å–æ–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (>5%) —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.\n–ú–µ—Ç—Ä–∏–∫–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥.",
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "max": 100,
          "min": 0,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "yellow",
                "value": 50
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "percent"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "minVizHeight": 75,
        "minVizWidth": 75,
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "showThresholdLabels": false,
        "showThresholdMarkers": true,
        "sizing": "auto"
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "expr": "sum(count_over_time({service=\"nginx\", log_type=\"access\"} | regexp \"\\\".*\\\" (?P<status>[0-3][0-9]{2})\" [15m]))",
          "refId": "A"
        },
        {
          "expr": "sum(count_over_time({service=\"nginx\", log_type=\"access\"} | regexp \"\\\".*\\\" (?P<status>[4-5][0-9]{2})\" [15m]))",
          "refId": "B"
        }
      ],
      "title": "Error Rate",
      "type": "gauge"
    },
    {
      "datasource": "loki",
      "description": "–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤.\n–ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Ç—Ä–∞—Ñ–∏–∫–∞.\nGET –æ–±—ã—á–Ω–æ –¥–æ–º–∏–Ω–∏—Ä—É–µ—Ç, POST —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "fillOpacity": 80,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "lineWidth": 1,
            "scaleDistribution": {
              "type": "linear"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          },
          "unit": "string"
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 6,
        "x": 6,
        "y": 0
      },
      "id": 2,
      "options": {
        "barRadius": 0,
        "barWidth": 0.97,
        "fullHighlight": false,
        "groupWidth": 0.7,
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "orientation": "auto",
        "showValue": "auto",
        "stacking": "none",
        "tooltip": {
          "mode": "single",
          "sort": "none"
        },
        "xTickLabelRotation": 0,
        "xTickLabelSpacing": 0
      },
      "targets": [
        {
          "expr": "sum by (method)(count_over_time({service=\"nginx\", log_type=\"access\"} | regexp \"\\\"(?P<method>[A-Z]+)\\\\s\" [5m]))",
          "refId": "C"
        }
      ],
      "title": "Top HTTP Methods",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "cf42racpw1ds0f"
      },
      "description": "",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "id": 7,
      "options": {
        "code": {
          "language": "plaintext",
          "showLineNumbers": false,
          "showMiniMap": false
        },
        "content": "# üìä Nginx Logs Monitoring Dashboard\n\n## –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ\n–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ Nginx –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –î–∞—à–±–æ—Ä–¥ –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Å—Ç—Ä–æ –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –æ—à–∏–±–∫–∏, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏.\n\n## üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏\n- **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –¥–∞—à–±–æ—Ä–¥—ã\n- **Loki** - –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ LogQL –∑–∞–ø—Ä–æ—Å—ã\n- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫\n- **Vector** - –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –ª–æ–≥–æ–≤ –∏–∑ Nginx –≤ Loki\n- **Nginx** - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä\n\n## üìñ –ö–∞–∫ —á–∏—Ç–∞—Ç—å –¥–∞—à–±–æ—Ä–¥\n\n### –ó–µ–ª—ë–Ω—ã–π —Ü–≤–µ—Ç = –≤—Å—ë —Ö–æ—Ä–æ—à–æ ‚úÖ\n- –ù–∏–∑–∫–∏–π Error Rate\n- –ú–Ω–æ–≥–æ —É—Å–ø–µ—à–Ω—ã—Ö 2xx –æ—Ç–≤–µ—Ç–æ–≤\n\n### –ö—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç = –≤–Ω–∏–º–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚ö†Ô∏è\n- –í—ã—Å–æ–∫–∏–π Error Rate\n- –ú–Ω–æ–≥–æ –æ—à–∏–±–æ–∫ 5xx\n- –ê–Ω–æ–º–∞–ª–∏–∏ –≤ –æ–±—ä—ë–º–µ –ª–æ–≥–æ–≤\n\n## üîç –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é\n\n1. **–í—ã–±–∏—Ä–∞–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª** —Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É (Last 15 minutes, Last hour, etc)\n2. **Error Rate > 3%** - –ø—Ä–æ–±–ª–µ–º–∞! –°–º–æ—Ç—Ä–∏ Recent Error Logs\n3. **HTTP Status Codes** - –∏—â–∏ –∫—Ä–∞—Å–Ω—ã–µ —Å–∫–∞—á–∫–∏ (5xx –æ—à–∏–±–∫–∏)\n4. **Log Volume Over Time** - —Ä–µ–∑–∫–∏–π —Ä–æ—Å—Ç = DDoS –∏–ª–∏ –∞–Ω–æ–º–∞–ª–∏—è –≤ —Ç—Ä–∞—Ñ–∏–∫–µ\n\n## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏\n- Explore ‚Üí LogQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫\n- Prometheus targets ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è\n\n---\n\n# LogQL Queries Reference\n\n## LogQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ª–æ–≥–æ–≤\n\n### –í—Å–µ –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞ Nginx\n```logql\n{log_type=\"access\", service=\"nginx\"}\n```\n\n### –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ 5xx\n```logql\n{log_type=\"access\", service=\"nginx\"} |~ \"HTTP/[0-9.]+ 5[0-9]{2}\"\n```\n\n### –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ 4xx\n```logql\n{log_type=\"access\", service=\"nginx\"} |~ \"HTTP/[0-9.]+ 4[0-9]{2}\"\n```\n\n### –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ Nginx\n```logql\n{log_type=\"error\", service=\"nginx\"}\n```\n\n### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ GET\n```logql\ncount_over_time({log_type=\"access\", service=\"nginx\"} |~ \"GET\" [5m])\n```\n\n### –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—É—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, /fail)\n```logql\n{log_type=\"access\", service=\"nginx\"} |= \"/fail\"\n```\n\n## üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã\n\n1. –ù–∞–∂–º–∏ **Explore** (–±–æ–∫–æ–≤–æ–µ –º–µ–Ω—é —Å–ª–µ–≤–∞)\n2. –í—ã–±–µ—Ä–∏ **Loki** –∫–∞–∫ Data Source\n3. –°–∫–æ–ø–∏—Ä—É–π –æ–¥–∏–Ω –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã—à–µ\n4. –í—Å—Ç–∞–≤—å –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞\n5. –ù–∞–∂–º–∏ **Run**\n\n–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∂—É—Ç –≤—Å–µ –ª–æ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ñ–∏–ª—å—Ç—Ä–∞–º!",
        "mode": "markdown"
      },
      "pluginVersion": "10.4.1",
      "title": "\"Nginx Logs Monitoring Dashboard\"",
      "type": "text"
    },
    {
      "datasource": "loki",
      "description": "–°–∞–º—ã–µ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø—É—Ç–∏ –∏ —á–∞—Å—Ç–æ—Ç–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π.\n–ü–æ–º–æ–≥–∞–µ—Ç –≤—ã—è–≤–∏—Ç—å —Å–∞–º—ã–µ –Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ endpoints.",
      "fieldConfig": {
        "defaults": {
          "custom": {
            "align": "auto",
            "cellOptions": {
              "type": "auto"
            },
            "inspect": false
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 6
      },
      "id": 3,
      "options": {
        "cellHeight": "sm",
        "footer": {
          "countRows": false,
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "pluginVersion": "10.4.1",
      "targets": [
        {
          "expr": "topk(10, sum by (uri)(rate({service=\"nginx\", log_type=\"access\"} | regexp \"\\\"(?P<method>\\\\S+)\\\\s+(?P<uri>\\\\S+)\\\\s+(?P<protocol>\\\\S+)\\\"\" [5m])))",
          "refId": "D"
        }
      ],
      "title": "Top Requested URIs",
      "type": "table"
    },
    {
      "datasource": "loki",
      "description": "–¢—Ä–µ–Ω–¥ –∫–æ–¥–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤ Nginx –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.\n- 2xx (–∑–µ–ª—ë–Ω—ã–π): —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã\n- 5xx (–∫—Ä–∞—Å–Ω—ã–π): —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –æ—à–∏–±–∫–∏\n–†–µ–∑–∫–∏–µ —Å–∫–∞—á–∫–∏ 5xx —Ç—Ä–µ–±—É—é—Ç –≤–Ω–∏–º–∞–Ω–∏—è.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "id": 4,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "expr": "sum by (status)(count_over_time({service=\"nginx\", log_type=\"access\"} | regexp \"\\\".*\\\" (?P<status>[0-9]{3})\" [5m]))",
          "refId": "E"
        }
      ],
      "title": "HTTP Status Codes Over Time",
      "type": "timeseries"
    },
    {
      "datasource": {
        "type": "loki",
        "uid": "cf42racpw1ds0f"
      },
      "description": "–ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 –æ—à–∏–±–æ–∫ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ Nginx.\n–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º.\n–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –ª–æ–≥ –¥–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.\n",
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 14
      },
      "id": 6,
      "options": {
        "dedupStrategy": "none",
        "enableLogDetails": true,
        "prettifyLogMessage": false,
        "showCommonLabels": false,
        "showLabels": false,
        "showTime": false,
        "sortOrder": "Descending",
        "wrapLogMessage": false
      },
      "targets": [
        {
          "datasource": {
            "type": "loki",
            "uid": "cf42racpw1ds0f"
          },
          "editorMode": "code",
          "expr": "{service=\"nginx\", log_type=\"access\"}\r\n| pattern \"<ip> - - [<time>] \\\"<method> <uri> <http>\\\" <status> <size> \\\"<ref>\\\" \\\"<ua>\\\"\"\r\n| status =~ \"4..|5..\"\r\n",
          "queryType": "range",
          "refId": "G"
        }
      ],
      "title": "Recent Error Logs",
      "type": "logs"
    },
    {
      "datasource": "loki",
      "description": "–û–±—ä—ë–º –ª–æ–≥–æ–≤, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã—Ö Nginx –≤ —á–∞—Å.\n–ü–æ–º–æ–≥–∞–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏ –≤ —Ç—Ä–∞—Ñ–∏–∫–µ.\n–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏ retention –ø–æ–ª–∏—Ç–∏–∫–∏ –ª–æ–≥–æ–≤.",
      "fieldConfig": {
        "defaults": {
          "color": {
            "mode": "palette-classic"
          },
          "custom": {
            "axisBorderShow": false,
            "axisCenteredZero": false,
            "axisColorMode": "text",
            "axisLabel": "",
            "axisPlacement": "auto",
            "barAlignment": 0,
            "drawStyle": "line",
            "fillOpacity": 0,
            "gradientMode": "none",
            "hideFrom": {
              "legend": false,
              "tooltip": false,
              "viz": false
            },
            "insertNulls": false,
            "lineInterpolation": "linear",
            "lineWidth": 1,
            "pointSize": 5,
            "scaleDistribution": {
              "type": "linear"
            },
            "showPoints": "auto",
            "spanNulls": false,
            "stacking": {
              "group": "A",
              "mode": "none"
            },
            "thresholdsStyle": {
              "mode": "off"
            }
          },
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "color": "green",
                "value": null
              },
              {
                "color": "red",
                "value": 80
              }
            ]
          }
        },
        "overrides": []
      },
      "gridPos": {
        "h": 6,
        "w": 12,
        "x": 12,
        "y": 16
      },
      "id": 5,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "expr": "count_over_time({service=\"nginx\", log_type=\"access\"} [5m])",
          "refId": "F"
        }
      ],
      "title": "Log Volume Over Time",
      "type": "timeseries"
    }
  ],
  "schemaVersion": 39,
  "tags": [],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "browser",
  "title": "Nginx Logs Dashboard (FinalV2)",
  "uid": "bf4dgrf6sh0cgd",
  "version": 15,
  "weekStart": ""
}
